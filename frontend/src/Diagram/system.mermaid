flowchart LR

%% Edge Layer
subgraph EdgeLayer["Edge Layer"]
    CDN["CDN / Edge Cache"]
end

%% Frontend
subgraph FrontendLayer["Frontend Layer"]
    Browser["Customer Browser"]
    EditorBr["Merchant Editor Browser"]
end

%% Infrastructure
subgraph InfraLayer["Infrastructure Layer"]
    LB["Load Balancer & API Gateway"]
    ReactApp["React Renderer SSR/CSR"]
    EditorApp["Editor Frontend"]
    Auth["Auth Service"]
    LayoutAPI["Layout & Theme Service"]
    Media["Media Service / S3"]
    CoreAPI["Core Backend Products, Orders"]
    DB[("Postgres")]
    Cache[("Redis")]
    Search["Search Cluster"]
    Workers["Workers / Queue"]
    WS["Realtime Preview WebSocket"]
end

%% Connections
Browser --> CDN
CDN --> LB
LB --> ReactApp
ReactApp -->|"GET /store/:domain/config"| LayoutAPI
ReactApp -->|"GET product data"| CoreAPI
LayoutAPI --> DB
LayoutAPI --> Cache
ReactApp --> Media

EditorBr --> LB
LB --> EditorApp
EditorApp --> Auth
EditorApp --> LayoutAPI
EditorApp --> Media
EditorApp --> WS
EditorApp --> Workers

LayoutAPI --> Workers
Workers --> Media
CoreAPI --> DB
CoreAPI --> Search
Search --> CoreAPI
Cache --> ReactApp
WS --> EditorBr

%% Styling
classDef edgeStyle fill:#e3f2fd,stroke:#1976d2,stroke-width:2px,color:#000
classDef frontendStyle fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#000
classDef infraStyle fill:#e8f5e9,stroke:#388e3c,stroke-width:2px,color:#000
classDef dbStyle fill:#fff3e0,stroke:#f57c00,stroke-width:2px,color:#000
classDef cacheStyle fill:#fce4ec,stroke:#c2185b,stroke-width:2px,color:#000

class CDN edgeStyle
class Browser,EditorBr frontendStyle
class LB,ReactApp,EditorApp,Auth,LayoutAPI,Media,CoreAPI,Search,Workers,WS infraStyle
class DB dbStyle
class Cache cacheStyle
